<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>åœ£è¯æ ‘ | äº’åŠ¨ç²’å­ç³»ç»Ÿ</title>
    
    <!-- æœ¬åœ°å­—ä½“å¼•ç”¨ -->
    <style>
        @font-face {
            font-family: 'Cinzel';
            font-style: normal;
            font-weight: 400;
            src: local('Cinzel Regular'), local('Cinzel-Regular'), 
                 url('https://fonts.gstatic.com/s/cinzel/v19/8vIU7ww63mVu7gtz9Evnt6N.woff2') format('woff2');
            font-display: swap;
        }
        @font-face {
            font-family: 'Cinzel';
            font-style: normal;
            font-weight: 700;
            src: local('Cinzel Bold'), local('Cinzel-Bold'),
                 url('https://fonts.gstatic.com/s/cinzel/v19/8vIU7ww63mVu7gtz9Evnt6N.woff2') format('woff2');
            font-display: swap;
        }
    </style>
    
    <!-- æœ¬åœ°åŒ– Import Map -->
    <script type="importmap">
    {
        "imports": {
            "three": "./three.min.js",
            "three/addons/": "./js/addons/",
            "three/examples/jsm/controls/": "./js/addons/controls/",
            "three/examples/jsm/postprocessing/": "./js/addons/postprocessing/",
            "three/examples/jsm/environments/": "./js/addons/environments/",
            "three/examples/jsm/curves/": "./js/addons/curves/",
            "three/examples/jsm/loaders/": "./js/addons/loaders/",
            "three/examples/jsm/math/": "./js/addons/math/",
            "three/examples/jsm/shaders/": "./js/addons/shaders/"
        }
    }
    </script>
    
    <!-- CSSæ ·å¼å°†åœ¨ç¬¬äºŒéƒ¨åˆ† -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- åŠ è½½å™¨ -->
    <div class="loader" id="loader">
        <div class="spinner">
            <div class="spinner-inner"></div>
        </div>
        <div class="loader-text">
            <span class="loader-line">åŠ è½½èŠ‚æ—¥é­”æ³•</span>
            <span class="loader-dots">...</span>
        </div>
        <div class="loader-progress">
            <div class="progress-bar" id="loaderProgress"></div>
        </div>
    </div>

    <!-- æ€§èƒ½è­¦å‘Šï¼ˆä½æ€§èƒ½è®¾å¤‡æ˜¾ç¤ºï¼‰ -->
    <div class="performance-warning" id="performanceWarning">
        <div class="warning-icon">âš ï¸</div>
        <div class="warning-title">æ€§èƒ½æç¤º</div>
        <div class="warning-text">
            æ£€æµ‹åˆ°æ‚¨çš„è®¾å¤‡æ€§èƒ½è¾ƒä½ï¼Œä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼š
            <ul>
                <li>å°†è‡ªåŠ¨é™ä½ç”»è´¨å’Œç²’å­æ•°é‡</li>
                <li>å»ºè®®åœ¨è‰¯å¥½ç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨</li>
                <li>å…³é—­å…¶ä»–åº”ç”¨ç¨‹åºå¯æå‡æ€§èƒ½</li>
            </ul>
        </div>
        <div class="warning-actions">
            <button class="warning-btn primary" id="continueBtn">ç»§ç»­ä½“éªŒ</button>
            <button class="warning-btn secondary" id="lightweightBtn">è½»é‡æ¨¡å¼</button>
        </div>
    </div>

    <!-- è®¾å¤‡æç¤ºï¼ˆç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ -->
    <div class="device-hint" id="deviceHint">
        <div class="hint-content">
            <div class="hint-icon">ğŸ“±</div>
            <div class="hint-text">ç§»åŠ¨ç«¯å·²å¯ç”¨è§¦æ‘¸æ§åˆ¶ï¼Œå•æŒ‡æ—‹è½¬ï¼ŒåŒå‡»éšè—UI</div>
            <button class="hint-close" id="closeHint">Ã—</button>
        </div>
    </div>

    <!-- ä¸»UIå®¹å™¨ -->
    <div class="ui-container" id="uiContainer">
        <!-- å¤´éƒ¨ -->
        <div class="ui-header">
            <h1 class="title-gradient">åœ£è¯å¿«ä¹</h1>
            <div class="subtitle">Interactive Particle System</div>
        </div>

        <!-- æ“ä½œè¯´æ˜ -->
        <div class="instructions-container">
            <div class="instruction-desktop" id="desktopInstruction">
                <p class="instruction-text">æŒ‰ H é”®éšè—æ§åˆ¶é¢æ¿ â€¢ ç©ºæ ¼é”®åˆ‡æ¢æ¨¡å¼ â€¢ ESC é‡ç½®è§†å›¾</p>
                <p class="instruction-tip">ä½¿ç”¨æ‘„åƒå¤´è¿›è¡Œæ‰‹åŠ¿æ§åˆ¶ï¼ˆæåˆ/æ¡æ‹³/å¼ å¼€ï¼‰</p>
            </div>
            <div class="instruction-mobile" id="mobileInstruction">
                <div class="mobile-instruction-content">
                    <div class="instruction-section">
                        <div class="instruction-icon">ğŸ‘†</div>
                        <div class="instruction-text">å•æŒ‡æ‹–åŠ¨æ—‹è½¬åœºæ™¯</div>
                    </div>
                    <div class="instruction-section">
                        <div class="instruction-icon">âœŒï¸</div>
                        <div class="instruction-text">åŒæŒ‡æåˆèšç„¦ç…§ç‰‡</div>
                    </div>
                    <div class="instruction-section">
                        <div class="instruction-icon">ğŸ‘Š</div>
                        <div class="instruction-text">é•¿æŒ‰åˆ‡æ¢æ¨¡å¼</div>
                    </div>
                    <div class="instruction-section">
                        <div class="instruction-icon">ğŸ’«</div>
                        <div class="instruction-text">åŒå‡»éšè—/æ˜¾ç¤ºæ§åˆ¶</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡å¼æŒ‡ç¤ºå™¨ -->
        <div class="mode-indicator" id="modeIndicator">
            <div class="mode-icon" id="modeIcon">ğŸ„</div>
            <div class="mode-info">
                <div class="mode-title" id="modeText">åœ£è¯æ ‘æ¨¡å¼</div>
                <div class="mode-subtext" id="modeSubtext">ç²’å­æ’åˆ—ä¸ºåœ£è¯æ ‘å½¢çŠ¶</div>
            </div>
            <div class="mode-badge" id="fpsCounter">60 FPS</div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-section">
                <div class="upload-wrapper">
                    <button class="upload-btn glass-effect" id="uploadBtn">
                        <span class="upload-icon">ğŸ“·</span>
                        <span class="upload-text">æ·»åŠ å›å¿†ç…§ç‰‡</span>
                    </button>
                    <div class="upload-hint">
                        <span class="hint-icon">ğŸ’¡</span>
                        <span>æ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæœ€å¤§ 5MB</span>
                    </div>
                </div>
            </div>

            <!-- æ¨¡å¼æ§åˆ¶æŒ‰é’®ï¼ˆç§»åŠ¨ç«¯ï¼‰ -->
            <div class="mode-controls" id="modeControls">
                <button class="mode-btn" data-mode="TREE" data-active="true">
                    <span class="mode-btn-icon">ğŸ„</span>
                    <span class="mode-btn-text">åœ£è¯æ ‘</span>
                </button>
                <button class="mode-btn" data-mode="SCATTER" data-active="false">
                    <span class="mode-btn-icon">â„ï¸</span>
                    <span class="mode-btn-text">æ•£è½</span>
                </button>
                <button class="mode-btn" data-mode="FOCUS" data-active="false">
                    <span class="mode-btn-icon">âœ¨</span>
                    <span class="mode-btn-text">èšç„¦</span>
                </button>
            </div>
        </div>

        <!-- è®¾ç½®é¢æ¿ -->
        <div class="settings-panel">
            <button class="settings-toggle" id="settingsToggle">
                <span class="settings-icon">âš™ï¸</span>
                <span class="settings-text">è®¾ç½®</span>
            </button>
            <div class="settings-content" id="settingsContent">
                <div class="settings-section">
                    <label class="settings-label">
                        <span class="label-text">ç”»è´¨è®¾ç½®</span>
                        <select class="quality-select" id="qualitySelect">
                            <option value="low">ä½æ€§èƒ½</option>
                            <option value="medium" selected>å¹³è¡¡</option>
                            <option value="high">é«˜è´¨é‡</option>
                        </select>
                    </label>
                </div>
                <div class="settings-section">
                    <label class="settings-label">
                        <input type="checkbox" id="enableBloom" checked>
                        <span class="checkbox-custom"></span>
                        <span class="label-text">å¯ç”¨è¾‰å…‰æ•ˆæœ</span>
                    </label>
                </div>
                <div class="settings-section">
                    <label class="settings-label">
                        <input type="checkbox" id="enableShadows" checked>
                        <span class="checkbox-custom"></span>
                        <span class="label-text">å¯ç”¨é˜´å½±</span>
                    </label>
                </div>
            </div>
        </div>

        <!-- æç¤ºå®¹å™¨ï¼ˆæ¡Œé¢ç«¯ï¼‰ -->
        <div class="hint-container">
            <div class="hint-item">
                <span class="hint-key">H</span>
                <span class="hint-action">æ˜¾ç¤º/éšè—UI</span>
            </div>
            <div class="hint-item">
                <span class="hint-key">ç©ºæ ¼</span>
                <span class="hint-action">åˆ‡æ¢æ¨¡å¼</span>
            </div>
            <div class="hint-item">
                <span class="hint-key">ESC</span>
                <span class="hint-action">é‡ç½®è§†å›¾</span>
            </div>
        </div>

        <!-- ç…§ç‰‡è®¡æ•°å™¨ -->
        <div class="photo-counter" id="photoCounter">
            <span class="counter-icon">ğŸ–¼ï¸</span>
            <span class="counter-text">ç…§ç‰‡: <span id="photoCount">1</span></span>
        </div>
    </div>

    <!-- ç§»åŠ¨ç«¯å¿«æ·æ“ä½œæ  -->
    <div class="mobile-quickbar" id="mobileQuickbar">
        <button class="quick-btn" id="quickHide">
            <span class="quick-icon">ğŸ‘ï¸</span>
            <span class="quick-text">éšè—UI</span>
        </button>
        <button class="quick-btn" id="quickPhoto">
            <span class="quick-icon">ğŸ“¸</span>
            <span class="quick-text">æ·»åŠ ç…§ç‰‡</span>
        </button>
        <button class="quick-btn" id="quickReset">
            <span class="quick-icon">â†º</span>
            <span class="quick-text">é‡ç½®</span>
        </button>
    </div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
    <input type="file" id="fileInput" accept="image/*" style="display: none;">

    <!-- æ‘„åƒå¤´å®¹å™¨ï¼ˆæ‰‹åŠ¿è¯†åˆ«ç”¨ï¼‰ -->
    <div class="webcam-container" id="webcamContainer">
        <video id="webcam" autoplay playsinline muted></video>
        <canvas id="outputCanvas"></canvas>
        <div class="webcam-status">
            <div class="status-indicator" id="webcamStatus"></div>
            <div class="status-text">æ‘„åƒå¤´åˆå§‹åŒ–ä¸­...</div>
        </div>
    </div>

    <!-- Three.js ç”»å¸ƒ -->
    <canvas id="canvas3d" class="webgl-canvas"></canvas>

    <!-- è§¦æ‘¸æç¤º -->
    <div class="touch-hint" id="touchHint">
        <div class="touch-hint-content">
            <div class="touch-hint-text">å•æŒ‡æ‹–åŠ¨æ—‹è½¬åœºæ™¯</div>
            <div class="touch-hint-arrow">ğŸ‘‡</div>
        </div>
    </div>

    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
    <div class="footer">
        <div class="footer-content">
            <div class="footer-text">ğŸ„ åœ£è¯å¿«ä¹ â€¢ äº’åŠ¨ç²’å­ç³»ç»Ÿ ğŸ…</div>
            <div class="footer-links">
                <button class="footer-link" id="toggleFullscreen">å…¨å±</button>
                <button class="footer-link" id="toggleMute">é™éŸ³</button>
                <button class="footer-link" id="showHelp">å¸®åŠ©</button>
            </div>
        </div>
    </div>

    <!-- JavaScriptå°†åœ¨ç¬¬ä¸‰éƒ¨åˆ† -->
    <script type="module" src="script.js"></script>
</body>
</html>